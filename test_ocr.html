<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>OCR ภาษาไทย - Tesseract.js v5</title>
    <style>
      :root {
        --primary: #4ade80;
        --primary-dark: #22c55e;
        --surface: rgba(15, 23, 42, 0.75);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        font-family: "Sarabun", "Prompt", "Noto Sans Thai", system-ui, -apple-system,
          BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: #e2e8f0;
        background: radial-gradient(circle at top, #0f172a 0%, #020617 60%, #000 100%);
        overflow: hidden;
      }

      canvas#particleCanvas {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
      }

      .container {
        width: min(860px, 100%);
        padding: 2.5rem;
        border-radius: 24px;
        background: var(--surface);
        backdrop-filter: blur(16px);
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.45);
        position: relative;
        z-index: 1;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.35rem 1rem;
        border-radius: 999px;
        background: rgba(74, 222, 128, 0.15);
        color: var(--primary);
        font-size: 0.85rem;
        margin-bottom: 1rem;
      }

      h1 {
        margin: 0 0 0.6rem 0;
        font-size: clamp(1.8rem, 3vw, 2.6rem);
      }

      .subtitle {
        margin: 0 0 2rem 0;
        color: #cbd5f5;
        line-height: 1.6;
      }

      label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 600;
      }

      input[type="file"] {
        width: 100%;
        padding: 1rem;
        border-radius: 16px;
        border: 2px dashed rgba(226, 232, 240, 0.4);
        background: rgba(15, 23, 42, 0.35);
        color: inherit;
        cursor: pointer;
        transition: border-color 0.2s ease, background 0.2s ease;
      }

      input[type="file"]:hover {
        border-color: var(--primary);
        background: rgba(15, 23, 42, 0.55);
      }

      #preview {
        display: none;
        width: 100%;
        max-height: 420px;
        object-fit: contain;
        border-radius: 18px;
        margin: 1.5rem 0;
        background: rgba(15, 23, 42, 0.45);
        border: 1px solid rgba(226, 232, 240, 0.15);
        padding: 0.75rem;
      }

      button {
        width: 100%;
        border: none;
        border-radius: 16px;
        padding: 1rem 1.5rem;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        color: #0f172a;
        background: linear-gradient(120deg, var(--primary), var(--primary-dark));
        transition: transform 0.15s ease, box-shadow 0.15s ease;
        box-shadow: 0 15px 30px rgba(34, 197, 94, 0.35);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      button:not(:disabled):hover {
        transform: translateY(-2px);
      }

      textarea {
        margin-top: 1.5rem;
        width: 100%;
        min-height: 160px;
        border-radius: 16px;
        border: 1px solid rgba(226, 232, 240, 0.2);
        background: rgba(2, 6, 23, 0.65);
        color: inherit;
        padding: 1rem;
        font-size: 1rem;
        resize: vertical;
      }

      .api-panel {
        margin-top: 1.75rem;
        border-radius: 18px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(226, 232, 240, 0.12);
        padding: 1.25rem;
      }

      .api-panel h3 {
        margin: 0 0 0.75rem 0;
        font-size: 1rem;
        color: #a5b4fc;
      }

      pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 0.95rem;
        line-height: 1.4;
        color: #e0e7ff;
      }
    </style>
  </head>
  <body>
    <canvas id="particleCanvas"></canvas>
    <div class="container">
      <div class="badge">Realtime API Monitor</div>
      <h1>OCR ภาษาไทยผ่านเบราเซอร์</h1>
      <p class="subtitle">
        อัปโหลดรูปภาพใบเสร็จเพื่อตรวจจับข้อความด้วยโมเดล Tesseract.js v5 โดยตรงจากหน้าเว็บ
        และดูผลลัพธ์เหมือนตอบกลับจาก API ได้ทันที
      </p>

      <label for="imageUpload">เลือกรูปภาพที่ต้องการอ่านข้อมูล</label>
      <input type="file" id="imageUpload" accept="image/*" />
      <img id="preview" alt="ตัวอย่างรูปใบเสร็จที่เลือก" />

      <button id="runOcr" disabled>เริ่ม OCR</button>

      <textarea
        id="result"
        rows="10"
        cols="80"
        readonly
        placeholder="ผลลัพธ์ OCR จะปรากฏที่นี่..."
      ></textarea>

      <div class="api-panel">
        <h3>API Response Preview</h3>
        <pre id="apiPreview">{ "text": "รอผลลัพธ์จาก OCR..." }</pre>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("particleCanvas");
      const ctx = canvas.getContext("2d");
      const particles = [];
      const PARTICLE_COUNT = 80;

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      function createParticle() {
        return {
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: Math.random() * 2.5 + 0.7,
          speedX: (Math.random() - 0.5) * 0.4,
          speedY: (Math.random() - 0.5) * 0.4,
          alpha: Math.random() * 0.6 + 0.2,
        };
      }

      function initParticles() {
        particles.length = 0;
        for (let i = 0; i < PARTICLE_COUNT; i += 1) {
          particles.push(createParticle());
        }
      }

      function drawParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((particle) => {
          ctx.beginPath();
          ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(74, 222, 128, ${particle.alpha})`;
          ctx.fill();

          particle.x += particle.speedX;
          particle.y += particle.speedY;

          if (particle.x < 0 || particle.x > canvas.width) {
            particle.speedX *= -1;
          }
          if (particle.y < 0 || particle.y > canvas.height) {
            particle.speedY *= -1;
          }
        });

        requestAnimationFrame(drawParticles);
      }

      resizeCanvas();
      initParticles();
      drawParticles();
      window.addEventListener("resize", () => {
        resizeCanvas();
        initParticles();
      });
    </script>

    <!-- Load Tesseract.js v5 -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <script>
      const worker = Tesseract.createWorker();
      const imageInput = document.getElementById("imageUpload");
      const preview = document.getElementById("preview");
      const runButton = document.getElementById("runOcr");
      const resultArea = document.getElementById("result");
      const apiPreview = document.getElementById("apiPreview");

      let imageFile = null;

      imageInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        imageFile = file;
        const url = URL.createObjectURL(file);
        preview.src = url;
        preview.style.display = "block";
        runButton.disabled = false;
        resultArea.value = "";
        apiPreview.textContent = '{ "text": "พร้อมประมวลผล..." }';
      });

      runButton.addEventListener("click", async () => {
        if (!imageFile) return;
        runButton.disabled = true;
        runButton.textContent = "กำลังประมวลผล...";
        resultArea.value = "กำลังโหลดโมเดลภาษาไทย...";
        apiPreview.textContent = '{ "status": "loading_model" }';

        try {
          await worker.load();
          await worker.loadLanguage("tha");
          await worker.initialize("tha");
          resultArea.value = "กำลังรัน OCR...";
          apiPreview.textContent = '{ "status": "running_ocr" }';

          const {
            data: { text },
          } = await worker.recognize(imageFile);

          const cleanText = text.trim();
          resultArea.value = cleanText || text;
          apiPreview.textContent = JSON.stringify(
            {
              endpoint: "/ocr/thai",
              success: true,
              characters: cleanText.length,
              text: cleanText || text,
            },
            null,
            2
          );

          await worker.terminate();
        } catch (err) {
          console.error(err);
          resultArea.value = "❌ เกิดข้อผิดพลาด: " + err.message;
          apiPreview.textContent = JSON.stringify(
            { endpoint: "/ocr/thai", success: false, error: err.message },
            null,
            2
          );
        } finally {
          runButton.disabled = false;
          runButton.textContent = "เริ่ม OCR";
        }
      });
    </script>
  </body>
</html>
